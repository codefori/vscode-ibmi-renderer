<head>
  <script src="{elements}" type="module"></script>
  <script src="{konva}"></script>
  <link rel="stylesheet" href="{styles}">
  <link rel="stylesheet" href="{codicon}" id="vscode-codicon-stylesheet">

  <script>
    // TODO: move to a separate file
    const vscode = acquireVsCodeApi();

    window.onload = () => {
      let pxwPerChar = 8.45;
      let pxhPerChar = 11;
      let dspfWidth = 80;
      let dspfHeight = 24;

      var width = dspfWidth * pxwPerChar;
      var height = dspfHeight * pxhPerChar;

      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
      });

      const bg = new Konva.Rect({
        x: 0,
        y: 0,
        width: width,
        height: height,
        fill: 'black'
      });

      var layer = new Konva.Layer();
      layer.add(bg);

      var rectX = stage.width() / 2 - 50;
      var rectY = stage.height() / 2 - 25;

      function getNewSnapCords(x, y) {
        const newX = Math.round(x / pxwPerChar) * pxwPerChar;
        const newY = Math.round(y / pxhPerChar) * pxhPerChar;
        return { x: newX, y: newY };
      }

      function getLabelBox(row, col, text) {
        const width = text.length * pxhPerChar;
        const height = 11;

        var rectangle = new Konva.Group({
          x: (col - 1) * pxwPerChar,
          y: (row - 1) * pxhPerChar,
          width: width,
          height: height,
          draggable: true,
        });

        rectangle.on(`dragend`, e => {
          const { x, y } = e.target.attrs;
          console.log(x, y);
          const newCords = getNewSnapCords(x, y);
          e.target.to({
            x: newCords.x,
            y: newCords.y
          });
        })

        // add text to the label
        rectangle.add(new Konva.Text({
          text: text,
          fontSize: 14,
          fontFamily: `Consolas, "Liberation Mono", Menlo, Courier, monospace`,
          fill: 'green'
        }));

        // add cursor styling
        rectangle.on('mouseover', function () {
          document.body.style.cursor = 'pointer';
        });
        rectangle.on('mouseout', function () {
          document.body.style.cursor = 'default';
        });

        return rectangle;
      }

      var rectangleA = getLabelBox(1, 1, `12345678901234567890123456789012345678901234567890123456789012345678901234567890`);
      var rectangleB = getLabelBox(2, 1, `12345678901234567890123456789012345678901234567890123456789012345678901234567890`);

      layer.add(rectangleA);
      layer.add(rectangleB);
      stage.add(layer);
    };
  </script>
</head>

<!-- https://vscode-elements.github.io/guides/getting-started/ -->

<body>
  <div id="chat-container">
    <!-- The reason the tabs are seperate is because -->
    <!-- we don't want multiple canvases -->
    <vscode-tabs selected-index="0" fixed-pane="start">
      <vscode-tab-header slot="header">RCDFMT</vscode-tab-header>
      <vscode-tab-header slot="header">HEADER</vscode-tab-header>
      <vscode-tab-header slot="header">FOOTER</vscode-tab-header>
    </vscode-tabs>


    <div style="display: flex; height: 100vh;">
      <!-- Left Sidebar -->
      <div style="width: 15%; padding: 1em; box-shadow: 2px 0 5px rgba(0,0,0,0.1);">
        <vscode-form-group variant="settings-group">
          <vscode-label for="settings-textfield-01">
            Lorem <span class="normal">ipsum</span>:
          </vscode-label>
          <vscode-form-helper>
            <p>
              Lorem ipsum <code>let dolor = sit amet</code>, consectetur adipiscing
              elit. <span class="error">Suspendisse</span> faucibus imperdiet
              sapien, a gravida <a href="#">dolor</a>.
            </p>
          </vscode-form-helper>
          <vscode-textfield
            id="settings-textfield-01"
            placeholder="Placeholder example"
          ></vscode-textfield>
        </vscode-form-group>
      </div>

      <!-- Main Content -->
      <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
        <div id="container" style="margin: 2em;"></div>
      </div>

      <!-- Right Sidebar -->
      <div style="width: 15%; padding: 1em; box-shadow: -2px 0 5px rgba(0,0,0,0.1);">
        <vscode-form-group variant="settings-group">
          <vscode-label for="settings-textfield-01">
            Lorem <span class="normal">ipsum</span>:
          </vscode-label>
          <vscode-form-helper>
            <p>
              Lorem ipsum <code>let dolor = sit amet</code>, consectetur adipiscing
              elit. <span class="error">Suspendisse</span> faucibus imperdiet
              sapien, a gravida <a href="#">dolor</a>.
            </p>
          </vscode-form-helper>
          <vscode-textfield
            id="settings-textfield-01"
            placeholder="Placeholder example"
          ></vscode-textfield>
        </vscode-form-group>
      </div>
    </div></div>

  </div>
</body>